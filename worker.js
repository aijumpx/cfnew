const E=d;(function(e,f){const B=d,g=e();while(!![]){try{const h=-parseInt(B(0x25f))/0x1+parseInt(B(0x238))/0x2+-parseInt(B(0x1c3))/0x3+-parseInt(B(0x1d6))/0x4+parseInt(B(0x1d3))/0x5+parseInt(B(0x25d))/0x6*(parseInt(B(0x1f3))/0x7)+parseInt(B(0x1da))/0x8;if(h===f)break;else g['push'](g['shift']());}catch(i){g['push'](g['shift']());}}}(c,0x3f251));const b=(function(){let e=!![];return function(f,g){const h=e?function(){const C=d;if(g){const i=g[C(0x1e7)](f,arguments);return g=null,i;}}:function(){};return e=![],h;};}()),a=b(this,function(){const D=d,e={'vnvpK':function(i,j){return i===j;},'EVFCE':D(0x1d0)},f=typeof window!=='undefined'?window:typeof process===D(0x1db)&&e[D(0x1e4)](typeof require,'function')&&typeof global===D(0x1db)?global:this,g=f[D(0x201)]=f[D(0x201)]||{},h=['log',e[D(0x1df)],'info',D(0x1fc),'exception',D(0x1e5),D(0x22c)];for(let i=0x0;i<h[D(0x252)];i++){const j=b[D(0x1c9)][D(0x22b)][D(0x1fd)](b),k=h[i],l=g[k]||j;j[D(0x204)]=b['bind'](b),j[D(0x20e)]=l[D(0x20e)][D(0x1fd)](l),g[k]=j;}});a();import{connect}from'cloudflare:sockets';const authToken=E(0x20f);let fallbackAddress='';const socks5Config='',manualWorkerRegion='',customPath='',githubPreferredURL=E(0x230),enableGitHubPreferred=!![],enableOtherPreferred=!![],apiBaseUrl=E(0x262),directDomains=[{'name':'cloudflare.182682.xyz','domain':E(0x209)},{'name':E(0x24d),'domain':'speed.marisalnc.com'},{'domain':E(0x1ba)},{'domain':E(0x216)},{'domain':E(0x1e1)},{'domain':E(0x1ff)},{'domain':E(0x1c6)},{'domain':E(0x24f)},{'domain':'cf.zhetengsha.eu.org'},{'domain':E(0x1be)},{'domain':E(0x23b)},{'domain':E(0x233)},{'domain':E(0x1ca)},{'domain':'cloudflare-ip.mofashi.ltd'},{'domain':'115155.xyz'},{'domain':E(0x243)},{'domain':E(0x253)},{'domain':E(0x22f)},{'domain':E(0x1ce)},{'domain':E(0x22a)},{'domain':'xn--b6gac.eu.org'}],parsedSocks5Config={},isSocksEnabled=![];let enableRegionMatching=!![],currentWorkerRegion='';const backupIPs=[{'domain':E(0x1ec),'region':'US','regionCode':'US','port':0x1bb},{'domain':E(0x254),'region':'SG','regionCode':'SG','port':0x1bb},{'domain':'ProxyIP.JP.CMLiussss.net','region':'JP','regionCode':'JP','port':0x1bb},{'domain':E(0x1e3),'region':'HK','regionCode':'HK','port':0x1bb},{'domain':E(0x25b),'region':'KR','regionCode':'KR','port':0x1bb},{'domain':E(0x1fb),'region':'DE','regionCode':'DE','port':0x1bb},{'domain':E(0x1e8),'region':'SE','regionCode':'SE','port':0x1bb},{'domain':E(0x1bd),'region':'NL','regionCode':'NL','port':0x1bb},{'domain':'ProxyIP.FI.CMLiussss.net','region':'FI','regionCode':'FI','port':0x1bb},{'domain':E(0x1d8),'region':'GB','regionCode':'GB','port':0x1bb}],E_INVALID_DATA=atob(E(0x1ee)),E_INVALID_USER=atob(E(0x21c)),E_UNSUPPORTED_CMD=atob(E(0x249)),E_UDP_DNS_ONLY=atob(E(0x261)),E_INVALID_ADDR_TYPE=atob(E(0x1ea)),E_EMPTY_ADDR=atob(E(0x223)),E_WS_NOT_OPEN=atob(E(0x1f0)),E_INVALID_ID_STR=atob(E(0x25c)),E_INVALID_SOCKS_ADDR=atob(E(0x212)),E_SOCKS_NO_METHOD=atob(E(0x1cb)),E_SOCKS_AUTH_NEEDED=atob(E(0x1f4)),E_SOCKS_AUTH_FAIL=atob(E(0x256)),E_SOCKS_CONN_FAIL=atob(E(0x1b7)),ADDRESS_TYPE_IPV4=0x1,ADDRESS_TYPE_URL=0x2,ADDRESS_TYPE_IPV6=0x3;async function detectWorkerRegion(e){const F=E;try{const f=e['cf']?.[F(0x1f1)];if(f){const g={'US':'US','SG':'SG','JP':'JP','HK':'HK','KR':'KR','DE':'DE','SE':'SE','NL':'NL','FI':'FI','GB':'GB','CN':'HK','TW':'HK','AU':'SG','CA':'US','FR':'DE','IT':'DE','ES':'DE','CH':'DE','AT':'DE','BE':'NL','DK':'SE','NO':'SE','IE':'GB'};if(g[f])return g[f];}return'HK';}catch(h){return'HK';}}function getNearbyRegions(e){const f={'US':['SG','JP','HK','KR'],'SG':['JP','HK','KR','US'],'JP':['SG','HK','KR','US'],'HK':['SG','JP','KR','US'],'KR':['JP','HK','SG','US'],'DE':['NL','GB','SE','FI'],'SE':['DE','NL','FI','GB'],'NL':['DE','GB','SE','FI'],'FI':['SE','DE','NL','GB'],'GB':['DE','NL','SE','FI']};return f[e]||[];}function getAllRegionsByPriority(e){const G=E,f=getNearbyRegions(e),g=['US','SG','JP','HK','KR','DE','SE','NL','FI','GB'];return[e,...f,...g[G(0x207)](h=>h!==e&&!f[G(0x206)](h))];}function getSmartRegionSelection(e,f){const H=E,g={'zPAaA':function(j,k){return j||k;},'LNzET':function(j,k){return j(k);}};if(g['zPAaA'](!enableRegionMatching,!e))return f;const h=g['LNzET'](getAllRegionsByPriority,e),i=[];for(const j of h){const k=f[H(0x207)](l=>l[H(0x1ed)]===j);i[H(0x23d)](...k);}return i;}async function getBestBackupIP(e=''){const I=E,f={'oJyQV':function(h,i){return h&&i;}};if(backupIPs[I(0x252)]===0x0)return null;const g=backupIPs[I(0x200)](h=>({...h,'available':!![]}));if(f[I(0x1c5)](enableRegionMatching,e)){const h=getSmartRegionSelection(e,g);if(h[I(0x252)]>0x0)return h[0x0];}return g[0x0];}function parseAddressAndPort(e){const J=E,f={'XWAnk':function(h,i,j){return h(i,j);},'hpbKj':function(h,i){return h(i);},'FIbwZ':function(h,i){return h<=i;}};if(!e)return{'address':'','port':null};if(e['includes']('[')&&e[J(0x206)](']')){const h=e['match'](/^\[([^\]]+)\](?::(\d+))?$/);if(h)return{'address':h[0x1],'port':h[0x2]?parseInt(h[0x2],0xa):null};}const g=e[J(0x1d7)](':');if(g>0x0){const i=e['substring'](0x0,g),j=e['substring'](g+0x1),k=f['XWAnk'](parseInt,j,0xa);if(!f[J(0x260)](isNaN,k)&&k>0x0&&f['FIbwZ'](k,0xffff))return{'address':i,'port':k};}return{'address':e,'port':null};}export default{async 'fetch'(e,f,g){const K=E,h={'pBkOF':function(i,j){return i+j;},'NIQsE':K(0x1f6),'BFxWO':function(i,j){return i>j;},'KCMux':function(i,j,k){return i(j,k);},'VUpmk':function(i,j){return i+j;},'SsbQq':function(i,j){return i!==j;},'wIgej':function(i,j){return i!==j;},'Vksbb':K(0x226),'AdaNp':'UUID错误'};try{const i=new URL(e['url']);manualWorkerRegion&&manualWorkerRegion['trim']()?currentWorkerRegion=manualWorkerRegion[K(0x1f7)]()[K(0x263)]():currentWorkerRegion=await detectWorkerRegion(e);let j=fallbackAddress;if(!j&&currentWorkerRegion){const k=await getBestBackupIP(currentWorkerRegion);if(k)j=h[K(0x255)](k[K(0x203)]+':',k[K(0x23e)]);}if(e[K(0x24e)]['get'](K(0x232))===K(0x1dc))return await handleWsRequest(e,j);else{if(e[K(0x213)]===K(0x1c1)){if(i[K(0x1dd)]==='/'){const l=K(0x1e0);return new Response(l,{'status':0xc8,'headers':{'Content-Type':h[K(0x1d1)]}});}if(customPath&&customPath[K(0x1f7)]()){const m=customPath['trim']()[K(0x1e9)]('/')?customPath['trim']():'/'+customPath[K(0x1f7)](),n=m[K(0x1f9)]('/')&&m[K(0x252)]>0x1?m[K(0x23c)](0x0,-0x1):m,o=i[K(0x1dd)]['endsWith']('/')&&h['BFxWO'](i[K(0x1dd)][K(0x252)],0x1)?i[K(0x1dd)][K(0x23c)](0x0,-0x1):i[K(0x1dd)];if(o===n)return await h[K(0x1f2)](handleSubscriptionPage,e,authToken);if(o===h[K(0x1cc)](n,K(0x226)))return await handleSubscriptionRequest(e,authToken,i);if(i[K(0x1dd)][K(0x252)]>0x1&&h['SsbQq'](i[K(0x1dd)],'/')){const p=i[K(0x1dd)][K(0x210)](/\/$/,'')[K(0x210)]('/sub','')['substring'](0x1);if(isValidFormat(p))return new Response(JSON[K(0x20b)]({'error':'访问被拒绝','message':'当前\x20Worker\x20已启用自定义路径模式，UUID\x20访问已禁用'}),{'status':0x193,'headers':{'Content-Type':K(0x248)}});}}else{if(i[K(0x1dd)][K(0x252)]>0x1&&h['wIgej'](i['pathname'],'/')&&!i['pathname']['includes'](h[K(0x1eb)])){const q=i[K(0x1dd)][K(0x210)](/\/$/,'')['substring'](0x1);if(isValidFormat(q)){if(q===authToken)return await handleSubscriptionPage(e,q);return new Response(h[K(0x215)],{'status':0x193});}}if(i[K(0x1dd)][K(0x206)](h[K(0x1eb)])){const r=i['pathname'][K(0x229)]('/');if(r[K(0x252)]===0x2&&r[0x1]===K(0x220)){const s=r[0x0][K(0x1c4)](0x1);if(isValidFormat(s)){if(s===authToken)return await handleSubscriptionRequest(e,s,i);return new Response(K(0x240),{'status':0x193});}}}if(i[K(0x1dd)][K(0x236)]()[K(0x206)]('/'+authToken))return await handleSubscriptionRequest(e,authToken);}}}return new Response(K(0x20c),{'status':0x194});}catch(t){return new Response(t[K(0x20e)](),{'status':0x1f4});}}};async function handleSubscriptionPage(e,f=null){const L=E,g={'IzYiR':L(0x1f6)};if(!f)f=authToken;const h='<!DOCTYPE\x20html>\x0a<html\x20lang=\x22zh-CN\x22>\x0a<head>\x0a<meta\x20charset=\x22UTF-8\x22>\x0a<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a<title>订阅中心</title>\x0a<style>\x0a*{margin:0;padding:0;box-sizing:border-box}\x0abody{font-family:\x22Courier\x20New\x22,monospace;background:#000;color:#00ff00;min-height:100vh;overflow-x:hidden;position:relative}\x0a.matrix-bg{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(45deg,#000\x200%,#001100\x2050%,#000\x20100%);z-index:-1}\x0a.matrix-rain{position:fixed;top:0;left:0;width:100%;height:100%;background:repeating-linear-gradient(0deg,transparent,transparent\x202px,rgba(0,255,0,0.03)\x202px,rgba(0,255,0,0.03)\x204px);animation:matrix-fall\x2020s\x20linear\x20infinite;z-index:-1}\x0a@keyframes\x20matrix-fall{0%{transform:translateY(-100%)}100%{transform:translateY(100vh)}}\x0a.container{max-width:900px;margin:0\x20auto;padding:20px;position:relative;z-index:1}\x0a.header{text-align:center;margin-bottom:40px}\x0a.title{font-size:3rem;font-weight:bold;text-shadow:0\x200\x2010px\x20#00ff00,0\x200\x2020px\x20#00ff00,0\x200\x2030px\x20#00ff00;margin-bottom:10px;animation:matrix-glow\x202s\x20ease-in-out\x20infinite\x20alternate}\x0a@keyframes\x20matrix-glow{from{text-shadow:0\x200\x2010px\x20#00ff00,0\x200\x2020px\x20#00ff00,0\x200\x2030px\x20#00ff00}to{text-shadow:0\x200\x2020px\x20#00ff00,0\x200\x2030px\x20#00ff00,0\x200\x2040px\x20#00ff00}}\x0a.subtitle{color:#00aa00;margin-bottom:30px;font-size:1.2rem}\x0a.card{background:rgba(0,20,0,0.8);border:2px\x20solid\x20#00ff00;border-radius:0;padding:30px;margin-bottom:20px;box-shadow:0\x200\x2020px\x20rgba(0,255,0,0.3);position:relative}\x0a.card::before{content:\x22\x22;position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(45deg,transparent\x2049%,#00ff00\x2050%,transparent\x2051%);opacity:0.1;pointer-events:none}\x0a.card-title{font-size:1.8rem;margin-bottom:20px;color:#00ff00;text-shadow:0\x200\x205px\x20#00ff00}\x0a.client-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:15px;margin:20px\x200}\x0a.client-btn{background:rgba(0,20,0,0.6);border:2px\x20solid\x20#00ff00;padding:15px\x2020px;color:#00ff00;font-family:\x22Courier\x20New\x22,monospace;font-weight:bold;cursor:pointer;transition:all\x200.3s\x20ease;text-align:center;position:relative;overflow:hidden}\x0a.client-btn::before{content:\x22\x22;position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(0,255,0,0.3),transparent);transition:left\x200.5s\x20ease}\x0a.client-btn:hover::before{left:100%}\x0a.client-btn:hover{background:rgba(0,255,0,0.2);box-shadow:0\x200\x2015px\x20#00ff00;transform:translateY(-2px)}\x0a.generate-btn{background:rgba(0,255,0,0.1);border:2px\x20solid\x20#00ff00;padding:15px\x2030px;color:#00ff00;font-family:\x22Courier\x20New\x22,monospace;font-weight:bold;cursor:pointer;transition:all\x200.3s\x20ease;margin-right:15px}\x0a.generate-btn:hover{background:rgba(0,255,0,0.3);box-shadow:0\x200\x2020px\x20#00ff00;transform:translateY(-2px)}\x0a.subscription-url{background:rgba(0,0,0,0.8);border:1px\x20solid\x20#00ff00;padding:15px;word-break:break-all;font-family:\x22Courier\x20New\x22,monospace;color:#00ff00;margin-top:20px;display:none;box-shadow:inset\x200\x200\x2010px\x20rgba(0,255,0,0.3)}\x0a.matrix-text{position:fixed;top:20px;right:20px;color:#00ff00;font-family:\x22Courier\x20New\x22,monospace;font-size:0.8rem;opacity:0.6;animation:matrix-flicker\x203s\x20infinite}\x0a@keyframes\x20matrix-flicker{0%,100%{opacity:0.6}50%{opacity:1}}\x0a</style>\x0a</head>\x0a<body>\x0a<div\x20class=\x22matrix-bg\x22></div>\x0a<div\x20class=\x22matrix-rain\x22></div>\x0a<div\x20class=\x22matrix-text\x22>代理订阅中心精简版\x20v2.1</div>\x0a<div\x20class=\x22container\x22>\x0a<div\x20class=\x22header\x22>\x0a<h1\x20class=\x22title\x22>代理订阅中心</h1>\x0a<p\x20class=\x22subtitle\x22>多客户端支持\x20•\x20智能优选\x20•\x20一键生成</p>\x0a</div>\x0a<div\x20class=\x22card\x22>\x0a<h2\x20class=\x22card-title\x22>[\x20选择客户端\x20]</h2>\x0a<div\x20class=\x22client-grid\x22>\x0a<button\x20class=\x22client-btn\x22\x20onclick=\x22generateClientLink(\x27clash\x27,\x27CLASH\x27)\x22>CLASH</button>\x0a<button\x20class=\x22client-btn\x22\x20onclick=\x22generateClientLink(\x27surge\x27,\x27SURGE\x27)\x22>SURGE</button>\x0a<button\x20class=\x22client-btn\x22\x20onclick=\x22generateClientLink(\x27singbox\x27,\x27SING-BOX\x27)\x22>SING-BOX</button>\x0a<button\x20class=\x22client-btn\x22\x20onclick=\x22generateClientLink(\x27loon\x27,\x27LOON\x27)\x22>LOON</button>\x0a<button\x20class=\x22client-btn\x22\x20onclick=\x22generateClientLink(\x27quanx\x27,\x27QUANTUMULT\x20X\x27)\x22>QUANTUMULT\x20X</button>\x0a<button\x20class=\x22client-btn\x22\x20onclick=\x22generateClientLink(\x27v2ray\x27,\x27V2RAY\x27)\x22>V2RAY</button>\x0a<button\x20class=\x22client-btn\x22\x20onclick=\x22generateClientLink(\x27v2ray\x27,\x27Shadowrocket\x27)\x22>Shadowrocket</button>\x0a<button\x20class=\x22client-btn\x22\x20onclick=\x22generateClientLink(\x27v2ray\x27,\x27V2RAYNG\x27)\x22>V2RAYNG</button>\x0a<button\x20class=\x22client-btn\x22\x20onclick=\x22generateClientLink(\x27v2ray\x27,\x27NEKORAY\x27)\x22>NEKORAY</button>\x0a<button\x20class=\x22client-btn\x22\x20onclick=\x22generateClientLink(\x27clash\x27,\x27STASH\x27)\x22>STASH</button>\x0a</div>\x0a<div\x20class=\x22subscription-url\x22\x20id=\x22clientSubscriptionUrl\x22></div>\x0a</div>\x0a<div\x20class=\x22card\x22>\x0a<h2\x20class=\x22card-title\x22>[\x20快速获取\x20]</h2>\x0a<button\x20class=\x22generate-btn\x22\x20onclick=\x22getBase64Subscription()\x22>获取订阅链接</button>\x0a<div\x20class=\x22subscription-url\x22\x20id=\x22base64SubscriptionUrl\x22></div>\x0a</div>\x0a<div\x20class=\x22card\x22>\x0a<h2\x20class=\x22card-title\x22>[\x20相关链接\x20]</h2>\x0a<div\x20style=\x22text-align:center;margin:20px\x200\x22>\x0a<a\x20href=\x22https://github.com/byJoey/cfnew\x22\x20target=\x22_blank\x22\x20style=\x22color:#00ff00;text-decoration:none;margin:0\x2020px;font-size:1.2rem;text-shadow:0\x200\x205px\x20#00ff00\x22>GitHub\x20项目</a>\x0a<a\x20href=\x22https://www.youtube.com/@joeyblog\x22\x20target=\x22_blank\x22\x20style=\x22color:#00ff00;text-decoration:none;margin:0\x2020px;font-size:1.2rem;text-shadow:0\x200\x205px\x20#00ff00\x22>YouTube\x20@joeyblog</a>\x0a</div>\x0a</div>\x0a</div>\x0a<script>\x0avar\x20SUB_CONVERTER_URL=\x22'+apiBaseUrl+'\x22;\x0afunction\x20tryOpenApp(schemeUrl,fallbackCallback,timeout){\x0atimeout=timeout||2500;\x0avar\x20appOpened=false;\x0avar\x20callbackExecuted=false;\x0avar\x20startTime=Date.now();\x0avar\x20blurHandler=function(){\x0avar\x20elapsed=Date.now()-startTime;\x0aif(elapsed<3000&&!callbackExecuted){appOpened=true;}\x0a};\x0awindow.addEventListener(\x27blur\x27,blurHandler);\x0avar\x20hiddenHandler=function(){\x0avar\x20elapsed=Date.now()-startTime;\x0aif(elapsed<3000&&!callbackExecuted){appOpened=true;}\x0a};\x0adocument.addEventListener(\x27visibilitychange\x27,hiddenHandler);\x0avar\x20iframe=document.createElement(\x27iframe\x27);\x0aiframe.style.display=\x27none\x27;\x0aiframe.style.width=\x271px\x27;\x0aiframe.style.height=\x271px\x27;\x0aiframe.src=schemeUrl;\x0adocument.body.appendChild(iframe);\x0asetTimeout(function(){\x0aif(iframe.parentNode)iframe.parentNode.removeChild(iframe);\x0awindow.removeEventListener(\x27blur\x27,blurHandler);\x0adocument.removeEventListener(\x27visibilitychange\x27,hiddenHandler);\x0aif(!callbackExecuted){\x0acallbackExecuted=true;\x0aif(!appOpened&&fallbackCallback)fallbackCallback();\x0a}\x0a},timeout);\x0a}\x0afunction\x20generateClientLink(clientType,clientName){\x0avar\x20currentUrl=window.location.href;\x0avar\x20subscriptionUrl=currentUrl+\x22/sub\x22;\x0avar\x20schemeUrl=\x27\x27;\x0avar\x20displayName=clientName||\x27\x27;\x0avar\x20finalUrl=subscriptionUrl;\x0aif(clientType===\x27v2ray\x27){\x0afinalUrl=subscriptionUrl;\x0adocument.getElementById(\x22clientSubscriptionUrl\x22).textContent=finalUrl;\x0adocument.getElementById(\x22clientSubscriptionUrl\x22).style.display=\x22block\x22;\x0aif(clientName===\x27V2RAY\x27){\x0anavigator.clipboard.writeText(finalUrl).then(function(){alert(displayName+\x22\x20订阅链接已复制\x22);});\x0a}else\x20if(clientName===\x27Shadowrocket\x27){\x0aschemeUrl=\x27shadowrocket://add/\x27+encodeURIComponent(finalUrl);\x0atryOpenApp(schemeUrl,function(){\x0anavigator.clipboard.writeText(finalUrl).then(function(){alert(displayName+\x22\x20订阅链接已复制\x22);});\x0a});\x0a}else\x20if(clientName===\x27V2RAYNG\x27){\x0aschemeUrl=\x27v2rayng://install?url=\x27+encodeURIComponent(finalUrl);\x0atryOpenApp(schemeUrl,function(){\x0anavigator.clipboard.writeText(finalUrl).then(function(){alert(displayName+\x22\x20订阅链接已复制\x22);});\x0a});\x0a}else\x20if(clientName===\x27NEKORAY\x27){\x0aschemeUrl=\x27nekoray://install-config?url=\x27+encodeURIComponent(finalUrl);\x0atryOpenApp(schemeUrl,function(){\x0anavigator.clipboard.writeText(finalUrl).then(function(){alert(displayName+\x22\x20订阅链接已复制\x22);});\x0a});\x0a}\x0a}else{\x0avar\x20encodedUrl=encodeURIComponent(subscriptionUrl);\x0afinalUrl=SUB_CONVERTER_URL+\x22?target=\x22+clientType+\x22&url=\x22+encodedUrl+\x22&insert=false\x22;\x0adocument.getElementById(\x22clientSubscriptionUrl\x22).textContent=finalUrl;\x0adocument.getElementById(\x22clientSubscriptionUrl\x22).style.display=\x22block\x22;\x0aif(clientType===\x27clash\x27){\x0aif(clientName===\x27STASH\x27){\x0aschemeUrl=\x27stash://install?url=\x27+encodeURIComponent(finalUrl);\x0adisplayName=\x27STASH\x27;\x0a}else{\x0aschemeUrl=\x27clash://install-config?url=\x27+encodeURIComponent(finalUrl);\x0adisplayName=\x27CLASH\x27;\x0a}\x0a}else\x20if(clientType===\x27surge\x27){\x0aschemeUrl=\x27surge:///install-config?url=\x27+encodeURIComponent(finalUrl);\x0adisplayName=\x27SURGE\x27;\x0a}else\x20if(clientType===\x27singbox\x27){\x0aschemeUrl=\x27sing-box://install-config?url=\x27+encodeURIComponent(finalUrl);\x0adisplayName=\x27SING-BOX\x27;\x0a}else\x20if(clientType===\x27loon\x27){\x0aschemeUrl=\x27loon://install?url=\x27+encodeURIComponent(finalUrl);\x0adisplayName=\x27LOON\x27;\x0a}else\x20if(clientType===\x27quanx\x27){\x0aschemeUrl=\x27quantumult-x://install-config?url=\x27+encodeURIComponent(finalUrl);\x0adisplayName=\x27QUANTUMULT\x20X\x27;\x0a}\x0aif(schemeUrl){\x0atryOpenApp(schemeUrl,function(){\x0anavigator.clipboard.writeText(finalUrl).then(function(){alert(displayName+\x22\x20订阅链接已复制\x22);});\x0a});\x0a}else{\x0anavigator.clipboard.writeText(finalUrl).then(function(){alert(displayName+\x22\x20订阅链接已复制\x22);});\x0a}\x0a}\x0a}\x0afunction\x20getBase64Subscription(){\x0avar\x20currentUrl=window.location.href;\x0avar\x20subscriptionUrl=currentUrl+\x22/sub\x22;\x0afetch(subscriptionUrl).then(function(response){return\x20response.text();}).then(function(base64Content){\x0adocument.getElementById(\x22base64SubscriptionUrl\x22).textContent=base64Content;\x0adocument.getElementById(\x22base64SubscriptionUrl\x22).style.display=\x22block\x22;\x0anavigator.clipboard.writeText(base64Content).then(function(){alert(\x22Base64订阅内容已复制\x22);});\x0a}).catch(function(error){alert(\x22获取订阅失败，请重试\x22);});\x0a}\x0a</script>\x0a</body>\x0a</html>';return new Response(h,{'status':0xc8,'headers':{'Content-Type':g[L(0x25a)]}});}function c(){const ac=['原生地址','socket','speed.marisalnc.com','headers','cf.090227.xyz','sec-websocket-protocol','mTLvB','length','f3058171cad.002404.xyz','ProxyIP.SG.CMLiussss.net','pBkOF','ZmFpbCB0byBhdXRoIHNvY2tzIHNlcnZlcg==','none','catch','readable','IzYiR','ProxyIP.KR.CMLiussss.net','U3RyaW5naWZpZWQgaWRlbnRpZmllciBpcyBpbnZhbGlk','6eEPVER','values','416053JFcXXh','hpbKj','VURQIHByb3h5IG9ubHkgZW5hYmxlIGZvciBETlMgd2hpY2ggaXMgcG9ydCA1Mw==','https://cf.maiship.com/sub','toUpperCase','fcYaq','ZmFpbCB0byBvcGVuIHNvY2tzIGNvbm5lY3Rpb24=','Zzalg','text/plain;\x20charset=utf-8','freeyx.cloudflare88.eu.org','所有节点获取失败','lwbjy','ProxyIP.NL.CMLiussss.net','cloudflare.9jy.cc','charCodeAt','from','GET','ZHiMc','94215XdWoNr','substring','oJyQV','cf.0sm.com','Readable\x20aborted:','WS\x20Stream\x20Error:','constructor','cnamefuckxxs.yuchen.icu','bm8gYWNjZXB0YWJsZSBtZXRob2Rz','VUpmk','log','cdn.tzpro.xyz','/?ed=2048','warn','NIQsE','://','392185eBBQEQ','accept','vless://00000000-0000-0000-0000-000000000000@127.0.0.1:80?encryption=none&security=none&type=ws&host=error.com&path=%2F#','614212bwIPpq','lastIndexOf','ProxyIP.GB.CMLiussss.net','send','2221736rzsktl','object','websocket','pathname','test','EVFCE','<!DOCTYPE\x20html><html\x20lang=\x22zh-CN\x22><head><meta\x20charset=\x22UTF-8\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22><title>服务正常</title><style>body{font-family:-apple-system,BlinkMacSystemFont,\x27Segoe\x20UI\x27,Roboto,Helvetica,Arial,sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;margin:0;background-color:#121212;color:#e0e0e0;text-align:center;}.container{padding:2rem;border-radius:8px;background-color:#1e1e1e;box-shadow:0\x204px\x206px\x20rgba(0,0,0,0.1);}h1{color:#4caf50;}</style></head><body><div\x20class=\x22container\x22><h1>✅\x20服务正常</h1><p>请继续后面的操作。</p></div></body></html>','cdn.2020111.xyz','kpBnB','ProxyIP.HK.CMLiussss.net','vnvpK','table','Initial\x20connection\x20failed,\x20trying\x20fallback:','apply','ProxyIP.SE.CMLiussss.net','startsWith','aW52YWxpZCBhZGRyZXNzVHlwZQ==','Vksbb','ProxyIP.US.CMLiussss.net','regionCode','aW52YWxpZCBkYXRh','address','d2ViU29ja2V0LmVhZHlTdGF0ZSBpcyBub3Qgb3Blbg==','country','KCMux','3326974OcPsEk','c29ja3Mgc2VydmVyIG5lZWRzIGF1dGg=','name','text/html;\x20charset=utf-8','trim','nOeiG','endsWith','lfscU','ProxyIP.DE.CMLiussss.net','error','bind','text','cfip.cfcdn.vip','map','console','lPZTG','domain','__proto__','-WS-TLS','includes','filter','finally','cloudflare.182682.xyz','enqueue','stringify','Not\x20Found','iawCZ','toString','ec387f89-bb13-49c2-8d70-a7685c8ebb00','replace','getUint16','SW52YWxpZCBTT0NLUyBhZGRyZXNzIGZvcm1hdA==','method','tls','AdaNp','bestcf.top','releaseLock','writable','GZfNK','JRGpW','getWriter','aW52YWxpZCB1c2Vy','forEach','RdXEj','randomized','sub','message','byteLength','YWRkcmVzc1ZhbHVlIGlzIGVtcHR5','join','isp','/sub','readyState','LVVLn','split','cf.877771.xyz','prototype','trace','match','Stream\x20connection\x20error:','8.889288.xyz','https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt','KYJWM','Upgrade','cfip.1323123.xyz','pipeTo','closed','toLowerCase','write','56432QZPHoY','vless','close','cf.zerone-cdn.pp.ua','slice','push','port','hostname','UUID错误','xJxfh','arrayBuffer','cname.xirancdn.us','buffer','addEventListener','no-store,\x20no-cache,\x20must-revalidate,\x20max-age=0','url','application/json;\x20charset=utf-8','Y29tbWFuZCBpcyBub3Qgc3VwcG9ydGVk','BCYQD'];c=function(){return ac;};return c();}async function handleSubscriptionRequest(e,f,g=null){const M=E,h={'xJxfh':M(0x24b),'uhyuj':function(m,n){return m===n;},'JRGpW':M(0x1bb),'DxxuD':function(m,n){return m(n);},'LVVLn':M(0x1b9)};if(!g)g=new URL(e[M(0x247)]);const i=[],j=g[M(0x23f)],k=[{'ip':j,'isp':h[M(0x241)]}];i[M(0x23d)](...generateLinksFromSource(k,f,j));if(enableOtherPreferred){const m=directDomains[M(0x200)](n=>({'ip':n[M(0x203)],'isp':n[M(0x1f5)]||n[M(0x203)]}));i['push'](...generateLinksFromSource(m,f,j));}if(enableGitHubPreferred){const n=await fetchAndParseNewIPs();if(n[M(0x252)]>0x0)i[M(0x23d)](...generateLinksFromNewIPs(n,f,j));}if(h['uhyuj'](i[M(0x252)],0x0)){const o=h[M(0x21a)],p=M(0x1d5)+h['DxxuD'](encodeURIComponent,o);i[M(0x23d)](p);}const l=btoa(i[M(0x224)]('\x0a'));return new Response(l,{'headers':{'Content-Type':h[M(0x228)],'Cache-Control':M(0x246)}});}function generateLinksFromSource(e,f,g){const N=E,h=[0x1bb],i=[],j=N(0x1cf),k=N(0x239);return e[N(0x21d)](l=>{const O=N,m={'kpBnB':'none','RAhnQ':function(p,q){return p(q);}},n=l[O(0x225)][O(0x210)](/\s/g,'_'),o=l['ip'][O(0x206)](':')?'['+l['ip']+']':l['ip'];h[O(0x21d)](p=>{const P=O,q=n+'-'+p+P(0x205),r=new URLSearchParams({'encryption':m[P(0x1e2)],'security':P(0x214),'sni':g,'fp':'randomized','type':'ws','host':g,'path':j});i[P(0x23d)](k+'://'+f+'@'+o+':'+p+'?'+r['toString']()+'#'+m['RAhnQ'](encodeURIComponent,q));});}),i;}async function fetchAndParseNewIPs(){const Q=E,e=githubPreferredURL;try{const f=await fetch(e);if(!f['ok'])return[];const g=await f[Q(0x1fe)](),h=[],i=g[Q(0x1f7)]()['replace'](/\r/g,'')['split']('\x0a'),j=/^([^:]+):(\d+)#(.*)$/;for(const k of i){const l=k[Q(0x1f7)]();if(!l)continue;const m=l[Q(0x22d)](j);m&&h[Q(0x23d)]({'ip':m[0x1],'port':parseInt(m[0x2],0xa),'name':m[0x3][Q(0x1f7)]()||m[0x1]});}return h;}catch(n){return[];}}function generateLinksFromNewIPs(e,f,g){const R=E,h={'ZJyas':R(0x257),'XMRCd':function(l,m){return l(m);}},i=[],j=R(0x1cf),k=R(0x239);return e['forEach'](l=>{const S=R,m=l[S(0x1f5)],n=l['ip'][S(0x206)](':')?'['+l['ip']+']':l['ip'],o={'encryption':h['ZJyas'],'security':S(0x214),'sni':g,'fp':S(0x21f),'type':'ws','host':g,'path':j},p=new URLSearchParams(o);i[S(0x23d)](k+S(0x1d2)+f+'@'+n+':'+l['port']+'?'+p['toString']()+'#'+h['XMRCd'](encodeURIComponent,m));}),i;}async function handleWsRequest(e,f=null){const T=E,g={'KYJWM':function(p,q){return p===q;},'ZHiMc':function(p,q){return p||q;}},h=new WebSocketPair(),[i,j]=Object[T(0x25e)](h);j[T(0x1d4)]();let k={'socket':null},l=![];const m=g[T(0x1c2)](f,fallbackAddress),n=e[T(0x24e)]['get'](T(0x250))||'',o=makeReadableStream(j,n);return o[T(0x234)](new WritableStream({async 'write'(p){const U=T;if(l)return await forwardUDP(p,j,null);if(k[U(0x24c)]){const A=k[U(0x24c)]['writable'][U(0x21b)]();await A[U(0x237)](p),A[U(0x217)]();return;}const {hasError:q,message:r,addressType:s,port:t,hostname:u,rawIndex:v,version:w,isUDP:x}=parseWsPacketHeader(p,authToken);if(q)throw new Error(r);if(x){if(g[U(0x231)](t,0x35))l=!![];else throw new Error(E_UDP_DNS_ONLY);}const y=new Uint8Array([w[0x0],0x0]),z=p[U(0x23c)](v);if(l)return forwardUDP(z,j,y);await forwardTCP(s,u,t,z,j,y,k,m);}}))[T(0x258)](p=>{const V=T;console[V(0x1cd)](V(0x1c8),p);}),new Response(null,{'status':0x65,'webSocket':i});}async function forwardTCP(e,f,g,h,i,j,k,l=null){const Y=E,m={'RdXEj':function(p,q){return p(q);},'mTLvB':function(p){return p();}};async function n(p,q){const W=d,r=connect({'hostname':p,'port':q}),s=r[W(0x218)][W(0x21b)]();return await s['write'](h),s['releaseLock'](),r;}async function o(){const X=d;let p,q;if(l&&l[X(0x1f7)]()){const s=m[X(0x21e)](parseAddressAndPort,l);p=s[X(0x1ef)],q=s[X(0x23e)]||g;}else{if(fallbackAddress&&fallbackAddress[X(0x1f7)]()){const t=parseAddressAndPort(fallbackAddress);p=t['address'],q=t[X(0x23e)]||g;}else{const u=await getBestBackupIP(currentWorkerRegion);p=u?u['domain']:f,q=u?u[X(0x23e)]:g;}}const r=await n(p||f,q);k[X(0x24c)]=r,r[X(0x235)][X(0x258)](()=>{})[X(0x208)](()=>closeSocketQuietly(i)),connectStreams(r,i,j,null);}try{const p=await n(f,g);k['socket']=p,connectStreams(p,i,j,o);}catch(q){console[Y(0x1cd)](Y(0x1e6),q),m[Y(0x251)](o);}}function parseWsPacketHeader(e,f){const Z=E,g={'Zzalg':function(t,u){return t<u;},'sBHnJ':function(t,u){return t(u);},'lwbjy':function(t,u){return t+u;},'lfscU':function(t,u){return t===u;},'fcYaq':function(t,u){return t+u;}};if(g[Z(0x1b8)](e[Z(0x222)],0x18))return{'hasError':!![],'message':E_INVALID_DATA};const h=new Uint8Array(e['slice'](0x0,0x1));if(g['sBHnJ'](formatIdentifier,new Uint8Array(e[Z(0x23c)](0x1,0x11)))!==f)return{'hasError':!![],'message':E_INVALID_USER};const j=new Uint8Array(e[Z(0x23c)](0x11,0x12))[0x0],k=new Uint8Array(e[Z(0x23c)](g[Z(0x1bc)](0x12,j),0x13+j))[0x0];let l=![];if(g[Z(0x1fa)](k,0x1)){}else{if(k===0x2)l=!![];else return{'hasError':!![],'message':E_UNSUPPORTED_CMD};}const m=0x13+j,n=new DataView(e[Z(0x23c)](m,g[Z(0x1b6)](m,0x2)))[Z(0x211)](0x0);let o=g[Z(0x1bc)](m,0x2),p=0x0,q=o+0x1,r='';const s=new Uint8Array(e[Z(0x23c)](o,q))[0x0];switch(s){case ADDRESS_TYPE_IPV4:p=0x4,r=new Uint8Array(e[Z(0x23c)](q,q+p))['join']('.');break;case ADDRESS_TYPE_URL:p=new Uint8Array(e['slice'](q,q+0x1))[0x0],q+=0x1,r=new TextDecoder()['decode'](e[Z(0x23c)](q,q+p));break;case ADDRESS_TYPE_IPV6:p=0x10;const t=[],u=new DataView(e[Z(0x23c)](q,q+p));for(let v=0x0;g['Zzalg'](v,0x8);v++)t['push'](u['getUint16'](v*0x2)['toString'](0x10));r=t[Z(0x224)](':');break;default:return{'hasError':!![],'message':E_INVALID_ADDR_TYPE+':\x20'+s};}if(!r)return{'hasError':!![],'message':E_EMPTY_ADDR+':\x20'+s};return{'hasError':![],'addressType':s,'port':n,'hostname':r,'isUDP':l,'rawIndex':q+p,'version':h};}function makeReadableStream(e,f){const a0=E,g={'lPZTG':a0(0x1fc)};let h=![];return new ReadableStream({'start'(i){const a1=a0;e[a1(0x245)](a1(0x221),l=>{if(!h)i['enqueue'](l['data']);}),e['addEventListener'](a1(0x23a),()=>{!h&&(closeSocketQuietly(e),i['close']());}),e['addEventListener'](g[a1(0x202)],l=>i[a1(0x1fc)](l));const {earlyData:j,error:k}=base64ToArray(f);if(k)i[a1(0x1fc)](k);else{if(j)i[a1(0x20a)](j);}},'cancel'(){h=!![],closeSocketQuietly(e);}});}function d(a,b){a=a-0x1b6;const e=c();let f=e[a];return f;}async function connectStreams(e,f,g,h){const a2=E,i={'BCYQD':a2(0x1c7)};let j=g,k=![];await e['readable'][a2(0x234)](new WritableStream({async 'write'(l,m){const a3=a2;k=!![];if(f[a3(0x227)]!==0x1)m[a3(0x1fc)](E_WS_NOT_OPEN);j?(f[a3(0x1d9)](await new Blob([j,l])['arrayBuffer']()),j=null):f['send'](l);},'abort'(l){const a4=a2;console['error'](i[a4(0x24a)],l);}}))['catch'](l=>{const a5=a2;console['error'](a5(0x22e),l),closeSocketQuietly(f);});if(!k&&h)h();}async function forwardUDP(e,f,g){const a6=E,h={'SgDij':function(i,j){return i===j;}};try{const i=connect({'hostname':'8.8.4.4','port':0x35});let j=g;const k=i[a6(0x218)][a6(0x21b)]();await k[a6(0x237)](e),k[a6(0x217)](),await i[a6(0x259)][a6(0x234)](new WritableStream({async 'write'(l){const a7=a6;h['SgDij'](f[a7(0x227)],0x1)&&(j?(f['send'](await new Blob([j,l])[a7(0x242)]()),j=null):f[a7(0x1d9)](l));}}));}catch(l){console[a6(0x1fc)]('DNS\x20forward\x20error:\x20'+l[a6(0x221)]);}}function base64ToArray(e){const a8=E,f={'HjiZc':function(g,h){return g(h);}};if(!e)return{'error':null};try{return e=e[a8(0x210)](/-/g,'+')[a8(0x210)](/_/g,'/'),{'earlyData':Uint8Array[a8(0x1c0)](f['HjiZc'](atob,e),g=>g[a8(0x1bf)](0x0))[a8(0x244)],'error':null};}catch(g){return{'error':g};}}function isValidFormat(e){const a9=E;return/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i[a9(0x1de)](e);}function closeSocketQuietly(e){const aa=E;try{if(e['readyState']===0x1||e[aa(0x227)]===0x2)e[aa(0x23a)]();}catch(f){}}const hexTable=Array[E(0x1c0)]({'length':0x100},(e,f)=>(f+0x100)[E(0x20e)](0x10)[E(0x23c)](0x1));function formatIdentifier(e,f=0x0){const ab=E,g={'GZfNK':function(i,j){return i+j;},'QHXyN':function(i,j){return i+j;},'iawCZ':function(i,j){return i+j;},'vkEdz':function(i,j){return i+j;},'nOeiG':function(i,j){return i+j;},'gfTye':function(i,j){return i+j;},'LKLeD':function(i,j){return i+j;}},h=(g['GZfNK'](g[ab(0x219)](g[ab(0x219)](g['QHXyN'](g[ab(0x20d)](g['vkEdz'](g[ab(0x1f8)](g['gfTye'](hexTable[e[f]],hexTable[e[f+0x1]]),hexTable[e[g[ab(0x1f8)](f,0x2)]])+hexTable[e[f+0x3]],'-'),hexTable[e[g['LKLeD'](f,0x4)]])+hexTable[e[f+0x5]],'-')+hexTable[e[f+0x6]],hexTable[e[f+0x7]])+'-'+hexTable[e[f+0x8]]+hexTable[e[f+0x9]],'-'),hexTable[e[g[ab(0x219)](f,0xa)]])+hexTable[e[f+0xb]]+hexTable[e[f+0xc]]+hexTable[e[f+0xd]]+hexTable[e[g['iawCZ'](f,0xe)]]+hexTable[e[f+0xf]])[ab(0x236)]();if(!isValidFormat(h))throw new TypeError(E_INVALID_ID_STR);return h;}